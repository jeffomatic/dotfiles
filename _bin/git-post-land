#!/usr/bin/env bash
set -e

branch=`git branch | grep \* | cut -d ' ' -f2`
if [ $branch = 'master' ]; then
    echo "Can't post-land on master" >&2
    exit 1
fi

# Fetch first to engage any auth prompts.
git fetch

ref=`git rev-parse $branch`
echo "To restore your branch ($branch), run the following:"
echo "  git checkout $ref"

git checkout master
git merge --ff-only origin/master
git branch -D $branch
git remote prune origin
